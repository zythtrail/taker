!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports._prohibitedMonitor=t():e._prohibitedMonitor=t()}(this,(function(){return function(){"use strict";var e={d:function(t,n){for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return pe}});var n=function(e){let t;const n=new Set,o=(e,o)=>{const r="function"==typeof e?e(t):e;if(r!==t){const e=t;t=(null!=o?o:"object"!=typeof r)?r:Object.assign({},t,r),n.forEach((n=>n(t,e)))}},r=()=>t,i={setState:o,getState:r,subscribe:e=>(n.add(e),()=>n.delete(e)),destroy:()=>n.clear()};return t=e(o,r,i),i}((e=>({deviceId:"",needDurationActions:[],needDurationActionParams:{},actionTriggerTimes:{},setDeviceId:t=>e((()=>({deviceId:t}))),setNeedDurationActions:t=>e((()=>({needDurationActions:t}))),setNeedDurationActionParams:t=>e((()=>({needDurationActionParams:t}))),setActionTriggerTimes:t=>e((()=>({actionTriggerTimes:t})))})));const o=/([^{]+)({.+})?/,r=/^{|}$/g,i=/^['"]|['"]$/g,s=/\/\/([^/]+)\//,a={utm_source:30,utm_medium:20,utm_campaign:100,utm_term:100,utm_content:100,gclid:100,gbraid:100,wbraid:255,fbclid:255,ttclid:128,twclid:64,msclkid:64,gad_source:10,af_adset:100,af_adset_id:24,af_ad:100,af_ad_id:24,af_keywords:100,af_c_id:24,clickId:256,groupInvitationCode:20,ircid:30};var c={serializeParams(e){const t=[],n=Object.keys(e);for(let o=0,r=n.length;o<r;o++){const r=n[o];t.push(`${encodeURIComponent(r)}=${encodeURIComponent(e[r])}`)}return t.join("&")},getUrlDomain(e){const t=e.match(s);return t?t[1]:""},getUrlQuery(e){return this.getParsedUrl(window.location.href).searchParams.get(e)||""},getParsedUrl(e){return new URL(e)},getChannelIdByUserAgent(){var e,t;const n=null===(e=window.navigator.userAgent)||void 0===e||null===(t=e.match)||void 0===t?void 0:t.call(e,/channelId\/(\w+)/);return null==n?void 0:n[1]},getChannelContext(e){const t={channelId:"",referralSrc:""};if(!e)return t;let n="",o="";if(e.searchParams.forEach(((e,t)=>{const r=t.toLowerCase();"channelid"===r&&(n=e),"channelflag"===r&&(o=e)})),t.channelId=n||o,t.channelId)return t;const r="/join";if(e.pathname.endsWith(r))return t;if(!e.pathname.includes(r))return t;const i=e.pathname.split(`${r}/`)[1];if(!i)return t;const s=i.split("/")[0];if(s.startsWith("-"))return t;const a=s.split("-"),c=a[a.length-2]||"";return n=a[a.length-1],n&&(t.referralSrc=c,t.channelId=n),t},getOktsBaggageData(e){if(!e||!e.searchParams)return"";const t=e.searchParams,n=t.get("okts_baggage");if(n)return n;const o=[];return Object.keys(a).forEach((e=>{const n=t.get(e);if(!n)return;const r=this.filterXSS(n),i=a[e];r&&r.length<=i&&o.push(`${e}=${r}`)})),o.join(",")},getGABaggage(){const e=this.filterXSS(this.getCookie("_ga")).match(/^GA1\.\d+\.(.{1,30})$/);return e&&e[1]?`ga_client_id=${e[1]}`:""},getInternalOktsBaggage(){const e=sessionStorage.oktsBaggage,t=this.getGABaggage();return e&&!e.includes("ga_client_id=")&&t?`${e},${t}`:e||t},getFinalOktsBaggage(e){const t=this.getInternalOktsBaggage(),n=sessionStorage.getItem(e);if(!e||!n)return t;const o=`${e}=${n}`;return t?`${o},${t}`:o},getOriginalUrl(e){return e.replace(/([?&])t=\d+(&)?/,((e,t,n)=>t&&n?t===n?"&":"?":""))},setCookie(e,t,n){const o=new Date;o.setTime(o.getTime()+n),document.cookie=`${e}=${encodeURIComponent(t)};expires=${o.toGMTString()};path=/`},getCookie(e){const t=new RegExp(`(^| )${e}=([^;]*)(;|$)`),n=document.cookie.match(t);return n?decodeURIComponent(n[2]):""},parseTarget(e){const t=e.match(o),n={key:"",data:{}};if(t){const e=t[1],o=t[2],s={};if(o){o.replace(r,"").split(",").forEach((e=>{let t=e.split(":");t=t.map((e=>e.trim().replace(i,"")));const[n,o]=t;s[n]=o}))}n.key=e,n.data=s}return n},matchType(e,t){return Object.prototype.toString.call(e)===`[object ${t}]`},isArray(e){return this.matchType(e,"Array")},isObject(e){return this.matchType(e,"Object")},isInArray(e,t){if(Array.prototype.includes)return e.includes(t);for(let n=0,o=e.length;n<o;n++)if(e[n]===t)return!0;return!1},generateUUID(){let e=Date.now()+window.performance.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(t=>{const n=(e+16*this.cryptoRandom())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},valueExists(e){return null!=e&&""!==e},passedNamingCheck(e){return!/[^a-z0-9_]/.test(e)},toFixed(e){return Number(e.toFixed(4))},toUnderLineFormat(e){return e.replace(/([A-Z])/g,((e,t,n)=>0===n?`${t.toLowerCase()}`:`_${t.toLowerCase()}`))},filterXSS(e){if("string"!=typeof e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"};return e.replace(/[&<>"'/]/g,(e=>t[e]))},merge(e,t){const n={};return Object.keys({...e,...t}).forEach((o=>{var r;null==t[o]&&null==e[o]||(n[o]=null!==(r=t[o])&&void 0!==r?r:e[o])})),n},cryptoRandom(){var e;if(null!==(e=window)&&void 0!==e&&e.crypto){const e=new Uint32Array(1);return window.crypto.getRandomValues(e),e[0]/Math.pow(2,32)}return Math.random()},base64Id(){let e="";for(let t=0;t<22;++t)e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".charAt(Math.floor(64*this.cryptoRandom()));return e},isTargetingCookiesRejected(){if("undefined"==typeof window)return!1;if(void 0===window.OnetrustActiveGroups)return!1;try{return!window.OnetrustActiveGroups.includes("C0004")}catch(e){return!1}},removeKeyFromString(e,t){return"string"!=typeof e?e:"string"==typeof t&&t?e.split(",").map((e=>e.trim())).filter((e=>{const n=e.indexOf("=");return(-1===n?e:e.slice(0,n)).trim()!==t})).join(","):e}};const l="okex",d="undefined"!=typeof window,g=Boolean("undefined"==typeof window||"undefined"!=typeof process&&{NODE_ENV:"production",ASSETS_BUILD_TYPE:"publish",ASSETS_BUILD_VERSION:"2.6.142"}.SSR_ENV),u=!!d&&/OKApp\/\(\S+\/\S+\)/i.test(navigator.userAgent);let p={_expires:{}};if(d){const{ok_monitor:e='{ "_expires": {} }'}=localStorage;p=JSON.parse(e)}const m={};var h={setEnv(e){const{screen:t}=window,{_tk:n}=localStorage,{systemLanguage:o,language:r}=navigator;let{referrer:i}=document;m.site=this.getSiteInfo(),m.lcl=this.getProductLanguage(),m.fpid=c.getCookie("fingerprint_id"),i&&(i.length>256&&(i=i.substr(0,256)),m.rf=i),n&&(m.tk=n),m.lan=(o||r).toLowerCase();let s="0x0";if(t){const{width:e,height:n}=t;s=`${e}x${n}`}m.scr=s;const a=c.getCookie("first_ref");a&&(m.frf=a.slice(0,256))},getEnv(){return{...m,site:this.getSiteInfo(),lcl:this.getProductLanguage()}},isInApp(){return u},getDeviceId(){var e,t;const{deviceId:o}=n.getState();return o?Promise.resolve(o):null===(e=window.utils.ont)||void 0===e||null===(t=e.getDevId)||void 0===t?void 0:t.call(e)},toLocalStorage(e){let{key:t,value:n,maxAge:o}=e;p[t]=n,p._expires[t]=Date.now()+o,localStorage.ok_monitor=JSON.stringify(p)},removeLocalStorage(e){delete p[e],delete p._expires[e],localStorage.ok_monitor=JSON.stringify(p)},getClientValue(e){const t=sessionStorage.getItem(e);return t||this.getValueFromLocalStorage(e)},getValueFromLocalStorage(e){return Date.now()<p._expires[e]&&p[e]||""},syncUpLocalStorageToSessionStorage(e){const t=this.getValueFromLocalStorage(e);t&&sessionStorage.setItem(e,t)},shouldIgnoreAmpEvent(){return this.isIgnoreEnvironment()},getProductLanguage(){return c.getCookie("locale")||this.getOkGlobal().locale},__getOkGlobalSite(){return this.getOkGlobal().site||{}},getSiteInfo(){const e=this.__getOkGlobalSite().sign,t=this.__getOkGlobalSite().subSite;return e===l?t&&"OKX_GLOBAL"!==t?t.toLowerCase():l:e},isOKEx(){return this.__getOkGlobalSite().sign===l},isOKLink(){const e=this.__getOkGlobalSite();return"oklink"===e.sign||e.sign===l&&e.linkInOKX},isInternalSystem(){return"okex_inner"===this.__getOkGlobalSite().sign},isWeb3(){var e;return!0===(null===(e=this.__getOkGlobalSite())||void 0===e||null===(e=e.is)||void 0===e?void 0:e.Web3)},isInSSR(){return g},isInBrowser(){return d},isInExtension(){return window.inOKXExtension||window.inUIOKXExtension},isMiniApp(){return window.inMiniApp},isInDesktop(){var e;return null===(e=window)||void 0===e||null===(e=e.navigator)||void 0===e||null===(e=e.userAgent)||void 0===e||null===(e=e.toLocaleLowerCase())||void 0===e?void 0:e.includes("electron/")},isDevTestEnv(){return this.isInExtension()?"publish"!==window.ASSETS_BUILD_TYPE:["pre","prod"].indexOf(this.getOkGlobal().envSign)<0},isProdEnv(){return this.isInExtension()?"publish"===window.ASSETS_BUILD_TYPE:"prod"===this.getOkGlobal().envSign},isPreEnv(){return"pre"===this.getOkGlobal().envSign},isIgnoreEnvironment(){if(!this.isInBrowser())return!0;const e=this.getOkGlobal(),t=e.broker&&e.broker.is,n="1"===localStorage.simulatedTrading,{okjp:o}=e.site&&e.site.is||{};return t||n||!0===o},getOkGlobal(){return this.isInBrowser()&&(window._okGlobal||window.okGlobal)||{}},isEnableAMP(){return this.isProdEnv()||"true"===sessionStorage.getItem("monitor_amplitude_enable_for_test")},isEnableDataFinder(){return!this.isIgnoreEnvironment()&&(this.isProdEnv()||window.location.search.includes("__okdatafinder_test"))},isEnableDataFinderDebug(){return!this.isProdEnv()&&!this.isIgnoreEnvironment()&&window.location.search.includes("__okdatafinder_test")},getTk(){return u&&window.jsbridge?window.jsbridge.getTK().then((e=>e||(localStorage._tk||""))).catch((()=>{})):Promise.resolve(localStorage._tk||"")},getLastActivityTime(){const e=localStorage.getItem("_monitor_last_activity_time"),t=Number(e);return!t||Number.isNaN(t)?0:t},updateLastActivityTime(){const e=Date.now();localStorage.setItem("_monitor_last_activity_time",String(e))},getOrGenerateSessionId(){const e=localStorage.getItem("_monitor_sessionId"),t=this.getLastActivityTime(),n=Date.now();if(e&&n-t<18e5)return e;const o=String(Date.now());return localStorage.setItem("_monitor_sessionId",o),o}};let _="";if(h.isInBrowser()){const{cdnBaseUrl:e="//static.coinall.ltd"}=h.getOkGlobal();_=e}const f={okx:"okx",oklink:"oklink",web3:"web3",okcoin:"okcoin",internal_system:"internal_system"};var S={Actions:{CLICK:"clk",EXPOSE:"xps"},Configs:{ATTR_CLICK:"data-clk",ATTR_EXPOSE:"data-xps",ATTR_LISTEN:"data-lsn",EXPOSE_DURATION:500},REQUEST_LONG_WAIT_TIME:1e3,PERF_REPORT_DEFER_TIME:5e3,AMPLITUDE_PROJECT:f,AMPLITUDE_KEY_MAP:{[f.okx]:{prod:"56bf9d43d57f079e506b4f26c70a698f",dev:"1baf4c48da921e60512f74d455f02da8"},[f.oklink]:{prod:"d77757dff7616a060069e378595de0f7",dev:"d77757dff7616a060069e378595de0f7"},[f.web3]:{prod:"669cbf122dec17ceb8e68a78c8240d24",dev:"2f69d358792107218343f78d2488e305"},[f.okcoin]:{prod:"21c676d501be3d648464d7ae0038cd53",dev:"69ec37219ff98b032d9e1a1d3bd81de7"},[f.internal_system]:{prod:"118100a32c295da61d6c1809bcfe470e",dev:"118100a32c295da61d6c1809bcfe470e"}},CDN_BASE_URL:_,MILLISECONDS_OF_30_DAYS:2592e6,YESTERDAY:-864e5,DEBUG_KEY:"a6ywbd8",WEB3CATEGORY:["onchain","web3_homepage","wallet","web3_trade","nft","web3_discover","web3_invest","okc","onchain_data"],REQUEST_HEADERS:{deviceId:"Devid"},API_PATH:{INTERNAL:"/et/priapi/boss",OKLINK:"/et/priapi/lnweb",OKX:"/et/priapi/xweb"},internalCategory:["opboss"]};var v=class{constructor(){this.listeners={}}on(e,t,n){let o=[];const r=arguments.length;for(let e=0;e<r;e++)o.push(arguments[e]);o=o.length>3?o.splice(3,o.length-1):[],void 0!==this.listeners[e]?this.listeners[e].push({scope:n,callback:t,args:o}):this.listeners[e]=[{scope:n,callback:t,args:o}]}remove(e,t,n){if(void 0!==this.listeners[e]){const o=this.listeners[e].length,r=this.listeners[e].slice(0);for(let i=0;i<o;i++){const o=r[i];o.scope==n&&o.callback==t&&this.listeners[e].splice(i,1)}}}has(e,t,n){if(void 0!==this.listeners[e]){const o=this.listeners[e].length;if(void 0===t&&void 0===n)return o>0;for(let r=0;r<o;r++){const o=this.listeners[e][r];if((!n||o.scope==n)&&o.callback==t)return!0}}return!1}emit(e){if(void 0!==this.listeners[e]){const r=this.listeners[e].slice(),i=r.length;for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];for(let e=0;e<i;e++){const t=r[e];if(t&&t.callback){const e=n.concat(t.args);t.callback.apply(t.scope,e)}}}}};let w=!1;const E=new v,I="LOAD_SUCCESS",y="LOAD_FAILED";function k(){return new Promise(((e,t)=>{const n=e=>{E.emit(y),t(e)};w=!0;const{envSign:o,cdnBaseUrl:r}=h.getOkGlobal(),i=document.createElement("script");i.type="text/javascript",i.crossOrigin="anonymous",i.async=!0;let s="";switch(o){case"dev":s="cdndev";break;case"pre":s="cdnpre";break;default:s="cdn"}const a="amplitude-analytics-browser-2.11.8.js";h.isInExtension()||"extension"==={NODE_ENV:"production",ASSETS_BUILD_TYPE:"publish",ASSETS_BUILD_VERSION:"2.6.142"}.BUILD_TARGET_ENV?(i.src=`./scripts/lib/${a}`,i.integrity="sha384-xqvDNRHTNTbqEsaCHJBuL+ohIAflZIyjUW7MnSD/Bl20mW11ri9zTr8XDYF2MiS2"):(i.src=`${r}/${s}/assets/okfe/libs/monitor/${a}`,i.integrity="sha384-EeMLYO4Izpc3SCjHbLn1iwBHBhefXKXLUjoBpuQ3D5nlnKYrZ9Edhq/V9+XEAA12"),i.onload=function(){if(w=!1,!window.amplitude)return n("[Amplitude] Error: could not load SDK");E.emit(I),e()},i.onerror=function(e){w=!1,n(e)};const c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(i,c)}))}const b=h.isInBrowser()?JSON.parse(localStorage.__error__||"[]"):[];var O={getErrorInfo(e){const{message:t,filename:n,lineno:o,colno:r,error:i}=e;let s="";i&&i.stack?(s=i.stack,-1!==s.indexOf("@")&&(s=`${t} \n\r ${s}`)):(i||t)&&(s=`ThrowError: ${JSON.stringify(i||t)} \n\r at ${n}: ${o}: ${r}`);return{msg:t,file:n,line:o,col:r,stack:s,url:encodeURIComponent(window.location.href)}},isReported(e){let{file:t,line:n,col:o}=e;const r=`${t}__${n}__${o}`;return b.includes(r)},rememberError(e){let{file:t,line:n,col:o}=e;const r=`${t}__${n}__${o}`;b.unshift(r),b.length>50&&b.pop(),setTimeout((()=>{localStorage.__error__=JSON.stringify(b)}),0)}};var A=function(e,t){let n=null!==t?(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{expirationDays:365}).expirationDays:-1;if(n){const e=new Date;e.setTime(e.getTime()+24*n*60*60*1e3),n=e}let o=`${e}=${t}`;n&&(o+=`; expires=${n.toUTCString()}`),o+="; path=/",document.cookie=o},T=e=>{try{const t=document.cookie.split(";");let n=null;for(let o=0;o<t.length;o++){let r=t[o];for(;" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(e)){n=r.substring(e.length+1,r.length);break}}return n}catch(e){return null}};let D=null,P=!1;class x{constructor(e){h.setEnv(e),this._category=e.product}logPV(){if(P)return Promise.resolve();const e={_act:"_pv",_ct:"_pv",_action_type:"Show",_element_type:"Page",...this._getCommonData()};return P=!0,this.sendLogs(e)}logEvent(e){const t={},{category:n,action:o,target:r,params:i,extras:s,_m:a,anchor:l,elementType:d,actionType:g,tk:u}=e;if(Object.assign(t,{_ct:n,_act:o,_lb:encodeURIComponent(r||""),_anchor_en_name:encodeURIComponent(l||""),_element_type:encodeURIComponent(d||""),_action_type:encodeURIComponent(g||""),...this._getCommonData()}),t._tk=u||t._tk,c.isArray(i)){let e=0,n=0;i.forEach(((o,r)=>{if(c.isObject(o)){const{value:r,random:i}=o,s=encodeURIComponent(r);i?t["_unlist"+n++]=s:t["_reser"+e++]=s}else t[`_reser${r}`]=encodeURIComponent(o)}))}else if(c.valueExists(i)){let e=i;c.isObject(i)&&(e=JSON.stringify(i));const n=encodeURIComponent(e);t._v=n,t._reser0=n}if(s){s.page=encodeURIComponent(window.location.href);const e={};Object.keys(s).forEach((t=>{e[`__${t}`]=s[t]})),Object.assign(t,e)}return a&&(t._m=a),this.sendLogs(t)}_getCommonData(){const e={...h.getEnv()};localStorage._tk&&(e.tk=localStorage._tk);const{src:t}=sessionStorage,n=h.getClientValue("pageId"),o=h.getClientValue("channelId"),r=h.getClientValue("ref"),{deviceId:i=c.base64Id(),eventId:s=1,sequenceNumber:a=1}=JSON.parse(T("_monitor_extras")||"{}");A("_monitor_extras",JSON.stringify({deviceId:i,eventId:s+1,sequenceNumber:a+1}));const l=JSON.stringify({_amp_rejected:c.isTargetingCookiesRejected(),_device_id:i,_event_id:s,_sequence_number:a,_uuid:c.generateUUID()}),d={_cid:o,_web3_ref:r,_pgid:n,_source:t,_session_id:h.getOrGenerateSessionId(),_page_url:encodeURIComponent(window.location.href.slice(0,1024)),_initial_traffic_attribution:c.getInternalOktsBaggage(),_extras:encodeURIComponent(l)};return Object.keys(e).forEach((t=>{d[`_${t}`]=encodeURIComponent(e[t])})),d}sendLogs(e){const t=[];if(Object.keys(e).forEach((n=>{const o=e[n];c.valueExists(o)?t.push(`${n}=${o}`):delete e[n]})),h.isDevTestEnv()){const{console:t}=window;return t.groupCollapsed(`dev monitor: ${e._ct} > ${e._act}`),t.log(decodeURIComponent(JSON.stringify(e,null,2))),t.groupEnd(),Promise.resolve()}return h.isInApp()&&window.jsbridge?window.jsbridge.getTK().then((e=>{if(e){const n=`_tk=${encodeURIComponent(e)}`,o=t.findIndex((e=>/^_tk/.test(e)));o>-1?t[o]=n:t.push(n)}return this.addClientInfo(t.join("&"))})).catch((()=>this.addClientInfo(t.join("&")))):this.addClientInfo(t.join("&"))}addClientInfo(e){const t=`&_ts=${Date.now()}&_r=${Math.floor(2147483648*c.cryptoRandom())}`;let n=`${e}${t}`;return h.isInApp()&&window.jsbridge?window.jsbridge.getClientInfo().then((o=>{const r=o?`&_app_info=${encodeURIComponent(o)}`:"";return n=`${e}${r}${t}`,this.sendRequest(n)})).catch((e=>this.sendRequest(n))):this.sendRequest(n)}getApiPath(){if(S.internalCategory.includes(this._category))return S.API_PATH.INTERNAL;return h.isOKLink()?S.API_PATH.OKLINK:S.API_PATH.OKX}async sendRequest(e){const t=await h.getDeviceId(),n=`_mv=${S.DEBUG_KEY}&_uid=${encodeURIComponent(t)}&${e}`;return h.updateLastActivityTime(),new Promise(((e,o)=>{const r=h.isInExtension()&&!h.isMiniApp(),i=this.getApiPath();if(navigator.sendBeacon&&!r)navigator.sendBeacon(i,n),e();else{const s=r?ne.dwApiEndpoint||`https://www.oklink.com${S.API_PATH.OKX}`:i,a=new XMLHttpRequest;a.open("POST",s),a.setRequestHeader(S.REQUEST_HEADERS.deviceId,t),a.onload=()=>200!==a.status?o(new Error(`Error ${a.status}:${a.statusText}`)):e(),a.onerror=()=>{o(new Error(`Error ${a.status}: ${a.statusText}`))},a.send(n),setTimeout((()=>{e()}),150)}}))}}const{Actions:C,Configs:L}=S;var R={listen(e,t){document.addEventListener("click",(n=>{const{target:o}=n;o.getAttribute(L.ATTR_LISTEN)&&t.preprocess();const r=o.getAttribute(L.ATTR_CLICK);if(r){const t=c.parseTarget(r),{key:n,data:o}=t;n&&e({target:n,action:C.CLICK,params:o,extras:{area:o.area}})}}))}};const U={},{Actions:$,Configs:N}=S;var B={listen(e){this.trackFn=e;const t=new window.IntersectionObserver(this.onSectionChange.bind(this),{threshold:[.5,1]});document.querySelectorAll(`[${N.ATTR_EXPOSE}]`).forEach((e=>{t.observe(e)})),this.observer=t},onSectionChange(e){e.forEach((e=>{const{target:t,isIntersecting:n}=e,o=t.getAttribute(N.ATTR_EXPOSE),r=c.parseTarget(o),{key:i,data:s}=r,a=Number(e.time.toFixed(2));if(n){const e=setTimeout((()=>{const e=U[i],n=t.getBoundingClientRect(),{innerHeight:o,innerWidth:r}=window,{top:c,bottom:l,left:d,right:g}=n;if((c>=0&&c<=o||l>=0&&l<=o)&&(d>=0&&d<=r||g>=0&&g<=r)){const{area:n,elementType:o,actionType:r}=s;delete s.area,delete s.elementType,delete s.actionType,this.trackFn({target:i,action:$.EXPOSE,params:{...s,time:a},extras:{area:n},actionType:r||"Show",elementType:o,anchor:o?i:""}),this.observer.unobserve(t),e.forEach((e=>{window.clearTimeout(e)})),delete U[i]}else e.shift()}),N.EXPOSE_DURATION);U[i]||(U[i]=[]),U[i].push(e)}}))}};const{Configs:j}=S;var F={listen(e){const t=t=>{e.logEvent({...t,category:"ok"})};this.preprocess(),R.listen(t,this),B.listen(t,this)},preprocess(){document.querySelectorAll(`[${j.ATTR_LISTEN}]`).forEach((e=>{const t=e.getAttribute(j.ATTR_LISTEN),n=t.indexOf(":");if(n>-1){const o=t.substring(0,n).trim(),r=t.substring(n+1).trim();o.split("+").forEach((t=>{e.setAttribute(`data-${t.trim()}`,r)})),e.removeAttribute(j.ATTR_LISTEN)}}))}};let G,K={};const V=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;const n="string"==typeof e?e:e.action||e.anchor,o=+new Date;return!(o-(K[n]||0)<t)&&((e=>{void 0!==G&&clearTimeout(G),G=setTimeout((()=>{K={},G=void 0}),e+500)})(t),K[n]=o,!0)},M={okx:"okx",web3:"web3",internal_system:"internal_system",oklink:"oklink"},X={[M.okx]:10000010,[M.web3]:10000007,[M.oklink]:10000007,[M.internal_system]:10000009};let q=!1;const J=new v,Y="LOAD_SUCCESS",W="LOAD_FAILED";function H(){return new Promise(((e,t)=>{const n=e=>{J.emit(W),t(e)};q=!0,function(){const e="okDataFinder";if(window.LogAnalyticsObject=e,!window[e]){const t=function(){t.q.push(arguments)};t.q=t.q||[],window[e]=t}window[e].l=+new Date}();const{envSign:o,cdnBaseUrl:r}=h.getOkGlobal(),i=document.createElement("script");i.type="text/javascript",i.crossOrigin="anonymous",i.async=!0;let s="";switch(o){case"dev":s="cdndev";break;case"pre":s="cdnpre";break;default:s="cdn"}h.isInExtension()||"extension"==={NODE_ENV:"production",ASSETS_BUILD_TYPE:"publish",ASSETS_BUILD_VERSION:"2.6.142"}.BUILD_TARGET_ENV?(i.src="./scripts/lib/collect-pure-v5.2.9.js",i.integrity="sha384-lpjOyUtkqNFTqLx2vLV9bia4eqVhhvlQPqjvoRmxp5WPVKhA4JDa6Rm5wfSZEm/6"):(i.src=`${r}/${s}/assets/okfe/libs/monitor/collect-rangers-v5.2.9.js`,i.integrity="sha384-xKdaXQ3CK3dXRzrgrgrdI+SjPgffxbCWVSeiwXfp+lGQE6eExsr5JzctvTFEZj3v"),i.onload=function(){if(q=!1,!window.okDataFinder||"function"!=typeof window.okDataFinder)return n("[DataFinder] Error: could not load SDK");J.emit(Y),e()},i.onerror=function(e){q=!1,n(e)};const a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(i,a)}))}const Q=e=>e&&e in M?e:h.isWeb3()||h.isOKLink()?M.web3:h.isInternalSystem()?M.internal_system:M.okx,z={},Z={},ee=async e=>{var t;null!==(t=window)&&void 0!==t&&t.okDataFinder&&!window.okDataFinder.q||await async function(){if(q)return new Promise(((e,t)=>{J.on(Y,(t=>{e(t)})),J.on(W,(e=>{t(e)}))}));await H()}();const n=Q(e);return Z[n]?Z[n]:z[n]?Promise.resolve():(Z[n]=(async e=>{const t=await h.getTk(),n=await h.getDeviceId()||"";window.okDataFinder(`${e}.init`,{app_id:X[e],channel_domain:ne.dataFinderApiEndpoint||`${window.location.origin}/priapi/df`,enable_anonymousid:!0,enable_debug:h.isEnableDataFinderDebug(),log:h.isEnableDataFinderDebug()}),window.okDataFinder(`${e}.setAnonymousId`,n),window.okDataFinder(`${e}.config`,{user_unique_id:e===M.web3?n:t,session_id:h.getOrGenerateSessionId(),app_version:h.getOkGlobal().assetsBuildVersion,okx_device_id:n}),window.okDataFinder(`${e}.start`),z[e]=!0,delete Z[e]})(n),Z[n])};let te=!1;class ne{constructor(e){h.isInSSR()||(this.commonParams=e.commonParams||{},this._logger=function(e){return D||(D=new x(e),D)}(e),this._category=e.product,e.withPV&&this.delayReportPV(),te||(this._initEventListener(),te=!0))}delayReportPV(){setTimeout((()=>{this.logPV()}),1e3)}setApiEndpoint(e){ne.apiEndpoint=e}setDWApiEndpoint(e){ne.dwApiEndpoint=e}setDataFinderApiEndpoint(e){ne.dataFinderApiEndpoint=e}report(e){let{type:t,value:n}=e;if(h.isInSSR())return Promise.resolve();let o=n;return(c.isObject(o)||c.isArray(o))&&(o=JSON.stringify(o)),this._logger.logEvent({category:"performance",action:t,params:o})}logPV(){return this._logger.logPV()}logDataFinder(e,t,n){return h.isInSSR()?Promise.resolve():(async(e,t,n)=>{const o=Q(n);z[o]||await ee(n);const r=localStorage.getItem("_monitor_sessionId"),i=h.getOrGenerateSessionId();r!==i&&window.okDataFinder(`${o}.config`,{session_id:i}),h.updateLastActivityTime(),window.okDataFinder(`${o}.config`,{language:h.getOkGlobal().locale});const s={...t,site:h.getSiteInfo()};window.okDataFinder(`${o}.${e}`,s)})(e,t,n)}logAmplitudeEvent(e,t,n){if(h.isInSSR()||h.shouldIgnoreAmpEvent())return Promise.resolve();let o="",r=!1;c.isObject(n)&&(o=n.ampProject,r=n.ignoreBackUp);const i={};for(const e in t)Object.prototype.hasOwnProperty.call(t,e)&&(i[e]=t[e]);if(i.monitor_after_navigation){delete i.monitor_after_navigation;const t=JSON.parse(sessionStorage.ampCacheEvents||"[]");return t.push([e,i]),sessionStorage.ampCacheEvents=JSON.stringify(t),Promise.resolve()}return ae.getInstance(o).then((n=>{const o=h.getOrGenerateSessionId();String(n.getSessionId())!==o&&n.setSessionId(o),h.updateLastActivityTime(),n.logEvent(e,{...i,site:h.getSiteInfo()},{language:h.getOkGlobal().locale}),r||this.act(e,t,{isSyncAMP:!1})}))}resetAmplitudeUser(){return h.isInSSR()?Promise.resolve():ae.getInstance().then((e=>(e.reset(),Promise.resolve())))}track(e,t,n,o){if(h.isInSSR())return Promise.resolve();const r={category:this._category,action:n,target:t,params:o,extras:{area:e}};if(c.isObject(e)){const{area:t,action:n,target:o,params:i}=e;Object.assign(r,{action:n,target:o,params:i,extras:{area:t}})}return this._logger.logEvent(r)}act(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isSyncAMP:!0};return h.isInSSR()?Promise.resolve():V(e)?new Promise(((o,r)=>{setTimeout((()=>{this._act(e,t,n).then(o,r)}),0)})):Promise.resolve()}async _act(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{isSyncAMP:!0};const{user_id:r,...i}=this.commonParams||{},s={web_mode_okx:c.isInArray(S.WEB3CATEGORY,this._category)?"wallet":"exchange"};let a,l=Object.assign({},h.isOKEx()?s:{}),d=(null==o?void 0:o.tk)||r,g={category:this._category,params:t,_m:"1"};c.isObject(t)&&(g.params=c.merge({...i,...l},t),l=c.merge(h.isOKLink()?{...i,...l}:l,t)),"string"==typeof e?(a=e,g.action=e):(a=e.action||e.anchor,g.action=a,g.anchor=e.anchor,g.actionType=e.actionType,g.elementType=e.elementType,g={...g,params:c.merge(g.params,e.params||{})},d=e.tk||d,l=c.merge(l,e.params)),g.tk=d;const{needDurationActions:u,needDurationActionParams:p,actionTriggerTimes:m,setActionTriggerTimes:_,setNeedDurationActionParams:f}=n.getState();if(h.isEnableAMP()&&null!=o&&o.isSyncAMP){const t=null==e?void 0:e.ampProject;this.logAmplitudeEvent(a,l,{ampProject:t,ignoreBackUp:!0})}if(c.isInArray(u,a))return m[a]=Date.now(),_(m),p[a]=g,f(p),Promise.resolve("The event will be reported when the page is closed");if(h.isEnableDataFinder()&&null!=e&&e.uploadCloudPlatform){const t=l||{},n=null==e?void 0:e.ampProject;this.logDataFinder(a,t,n)}return this._logger.logEvent(g)}_initEventListener(){window.addEventListener("load",(()=>{F.listen(this._logger)})),window.addEventListener("error",(e=>{const t=O.getErrorInfo(e);O.isReported(t)||(this._logger.logEvent({category:"error",action:"report",extras:t}),O.rememberError(t))}),!0),window.addEventListener("beforeunload",(()=>{const{needDurationActions:e,needDurationActionParams:t,actionTriggerTimes:o,setNeedDurationActions:r,setNeedDurationActionParams:i,setActionTriggerTimes:s}=n.getState();e.length&&e.forEach((e=>{t[e].params.duration=Date.now()-o[e],this._logger.logEvent(t[e])})),r([]),i({}),s({})}))}initABTest(e){null!=e&&e.exper_flagKey&&null!=e&&e.exper_variant&&(Object.assign(this.commonParams,e),this.act("ab_experiment"))}setCommonParams(e){this.commonParams={...this.commonParams,...e}}triggerReportDuration(e){const{needDurationActions:t,setNeedDurationActions:o}=n.getState();c.isInArray(t,e)||(t.push(e),o(t))}}const oe={};const re="RESOLVE",ie="REJECT",se={events:new v,getAmplitudeSDKInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(((t,n)=>{this.events.on(re,(e=>{t(e)})),this.events.on(ie,(e=>{n(e)})),this.getInstance(e)}))},async getInstance(e){const t=(e=>e||(h.isOKLink()?S.AMPLITUDE_PROJECT.oklink:h.isOKEx()||h.isInExtension()?S.AMPLITUDE_PROJECT.okx:S.AMPLITUDE_PROJECT.okcoin))(e);window.amplitude||await async function(){if(w)return new Promise(((e,t)=>{E.on(I,(t=>{e(t)})),E.on(y,(e=>{t(e)}))}));await k()}();const n=await h.getTk(),o=await h.getDeviceId()||"";if(oe[t])return oe[t];const r=window.amplitude.createInstance(),i=(e=>{var t;const n=h.isProdEnv(),o=null===(t=S.AMPLITUDE_KEY_MAP)||void 0===t?void 0:t[e];return o?n?null==o?void 0:o.prod:null==o?void 0:o.dev:""})(t),s=(()=>{if(h.isInternalSystem()||h.isOKEx()||h.isOKLink())return"/amplitude/2/httpapi"})(),a=ne.apiEndpoint?ne.apiEndpoint:s,c={userId:t===S.AMPLITUDE_PROJECT.web3?o:n,deviceId:o,instanceName:t,serverUrl:a,defaultTracking:!0,identityStorage:"localStorage",autocapture:{pageViews:!1,fileDownloads:!1,sessions:!1,formInteractions:!1},appVersion:h.getOkGlobal().assetsBuildVersion};if(r.init(i,c),r.setSessionId(h.getOrGenerateSessionId()),oe[t]=r,sessionStorage.channelId&&((e,t)=>{const n=new window.amplitude.Identify;n.set("channel_id",t),e.identify(n,{language:h.getOkGlobal().locale})})(r,sessionStorage.channelId),sessionStorage.ampCacheEvents){JSON.parse(sessionStorage.ampCacheEvents).forEach((e=>{r.logEvent(...e,{language:h.getOkGlobal().locale})})),sessionStorage.ampCacheEvents=""}return(e=>{const{signUpCompleted:t}=sessionStorage;t&&(e.logEvent("signup_completed",{},{language:h.getOkGlobal().locale}),sessionStorage.removeItem("signUpCompleted"))})(r),this.events.emit(re,r),r}};var ae=se;const ce=[{keyword:"baidu.com",type:"BaiduSEO"},{keyword:"google",type:"GoogleSEO"},{keyword:"yandex",type:"yandexSEO"},{keyword:"ya.ru",type:"yandexSEO"},{keyword:"dzen.ru",type:"yandexSEO"},{keyword:"yahoo",type:"yahooSEO"},{keyword:"so.com",type:"360SEO"},{keyword:"bing.com",type:"bingSEO"},{keyword:"sogou.com",type:"sogouSEO"},{keyword:"m.sm.cn",type:"smSEO"},{keyword:"naver",type:"naverSEO"},{keyword:"duckduckgo",type:"duckduckgoSEO"},{keyword:"ecosia",type:"EcosiaSEO"},{keyword:"startpage",type:"startpageSEO"}];var le={getSeoType(){const e=c.getUrlDomain(document.referrer);for(let t=0;t<ce.length;t++){const{keyword:n,type:o}=ce[t];if(e.indexOf(n)>-1)return o}return""}};const{MILLISECONDS_OF_30_DAYS:de}=S,ge=(e,t)=>{if(h.isInSSR())return;const{pathname:n}=window.location;sessionStorage.channelId=e,h.toLocalStorage({key:"channelId",value:e,maxAge:de}),t?(sessionStorage.referralSrc=t,h.toLocalStorage({key:"referralSrc",value:t,maxAge:de})):(sessionStorage.removeItem("referralSrc"),h.removeLocalStorage("referralSrc")),sessionStorage.pageId=n,h.toLocalStorage({key:"pageId",value:n,maxAge:de})};var ue={monitor:{get amplitude(){return h.isInSSR()?{getAmplitudeSDKInstance(){return new Promise(((e,t)=>{t("Currently not a browser environment!")}))}}:ae},newInstance(e){return h.isInSSR()?{setApiEndpoint(){},setDWApiEndpoint(){},setDataFinderApiEndpoint(){},report(){return Promise.resolve()},logPV(){return Promise.resolve()},logDataFinder(){return Promise.resolve()},logAmplitudeEvent(){return Promise.resolve()},resetAmplitudeUser(){return Promise.resolve()},track(){return Promise.resolve()},act(){return Promise.resolve()},_act(){return Promise.resolve()},_initEventListener(){},initABTest(){},setCommonParams(){},triggerReportDuration(){},delayReportPV(){}}:new ne(e)},saveChannelId(e){ge(e)},getChannelId(){return sessionStorage.channelId},clearChannelId(){sessionStorage.removeItem("channelId"),h.removeLocalStorage("channelId")},getOktsBaggage(){return c.getFinalOktsBaggage(h.isWeb3()?"ref":"channelId")},getRef(){return sessionStorage.ref},setDeviceId(e){const{setDeviceId:t}=n.getState();t(e)},getChannelContextFromUrl(e){return c.getChannelContext(c.getParsedUrl(e))}},parseUrl(){const e=c.getParsedUrl(window.location.href),t=e.searchParams.get("src");t&&sessionStorage.setItem("src",t),h.isWeb3()?this.parseRef(e):this.parseChannelId(e)},parseChannelId(e){const t=c.getChannelIdByUserAgent(),n=le.getSeoType(),o=c.getChannelContext(e);let r=o.channelId,i=o.referralSrc,s=!1;h.isInDesktop()&&t&&(r=t,i="",s=!0),!r&&n&&(r=n,s=!0),r=c.filterXSS(r),this.processOktsBaggage({urlObject:e,attributionKey:"channelId",attribution:r,shouldClearOktBaggage:s}),r?ge(r,i):(h.syncUpLocalStorageToSessionStorage("channelId"),sessionStorage.getItem("channelId")&&(h.syncUpLocalStorageToSessionStorage("referralSrc"),h.syncUpLocalStorageToSessionStorage("pageId")))},processOktsBaggage(e){let{urlObject:t,attributionKey:n,attribution:o,shouldClearStorage:r}=e;try{if(r)return sessionStorage.removeItem("oktsBaggage"),void h.removeLocalStorage("oktsBaggage");if(o){const e=c.getOktsBaggageData(t),o=c.removeKeyFromString(e,n);h.toLocalStorage({key:"oktsBaggage",value:o,maxAge:de})}h.syncUpLocalStorageToSessionStorage("oktsBaggage")}catch(e){console.log("Error processing oktsBaggage:",e)}},parseRef(e){let t="";e.searchParams.forEach(((e,n)=>{"ref"===n.toLowerCase()&&(t=e)}));const n="/join/";if(!t&&e.pathname.includes(n)){const o=e.pathname.split(n)[1];o&&(t=o.split("/")[0])}t=c.filterXSS(t),t&&h.toLocalStorage({key:"ref",value:t,maxAge:de}),this.processOktsBaggage({urlObject:e,attributionKey:"ref",attribution:t,shouldClearStorage:!1}),h.syncUpLocalStorageToSessionStorage("ref")},init(){if(!h.isInSSR()){if(this.parseUrl(),!c.getCookie("first_ref")&&document.referrer&&c.setCookie("first_ref",document.referrer.slice(0,256),de),"extension"!=={NODE_ENV:"production",ASSETS_BUILD_TYPE:"publish",ASSETS_BUILD_VERSION:"2.6.142"}.BUILD_TARGET_ENV&&!window.IntersectionObserver){const e=document.createElement("script");e.src=`${S.CDN_BASE_URL}/cdn/assets/okfe/libs/polyfills/intersection-observer.js`,document.getElementsByTagName("head")[0].appendChild(e)}window.utils=window.utils||{},window.utils.monitor=this.monitor}},saveChannelId(e){ge(e)}};ue.init();var pe=ue.monitor;return t=t.default}()}));
//# sourceMappingURL=index.js.map